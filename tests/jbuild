(jbuild_version 1)

; https://github.com/janestreet/jbuilder/tree/master/example/sample-projects/hello_world/test
; https://jbuilder.readthedocs.io/en/latest/jbuild.html#rule
; Note that contrary to makefiles or other build systems, user rules currently donâ€™t support patterns, such as a rule to produce %.y from %.x for any given %. This might be supported in the future.

(rule
 ((targets (empty.c.output))
  (deps (empty.c))
  (action (with-stdout-to ${@} (run ${bin:vmc} ${<})))))

(rule
 ((targets (array.c.output))
  (deps (array.c))
  (action (with-stdout-to ${@} (run ${bin:vmc} ${<})))))

(alias
 ((name runtest)
  (action (run diff -u --color=always ${path:empty.c.expected} ${path:empty.c.output}))
  (action (run diff -u --color=always ${path:array.c.expected} ${path:array.c.output}))
 ))
